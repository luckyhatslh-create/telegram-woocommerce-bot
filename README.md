# ü§ñ Telegram –±–æ—Ç: –ø—Ä–∏–º–µ—Ä–∫–∞ –≤—è–∑–∞–Ω–æ–π —à–∞–ø–∫–∏ –Ω–∞ –º–æ–¥–µ–ª—å

–ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–æ—Ç–æ –∏–∑–¥–µ–ª–∏—è (–≤—è–∑–∞–Ω–∞—è —à–∞–ø–∫–∞) –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–æ—Ç–æ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç –≤–∑—Ä–æ—Å–ª–æ–π –º–æ–¥–µ–ª–∏, –Ω–∞–¥–µ–≤–∞—è **–∏–º–µ–Ω–Ω–æ —ç—Ç—É** —à–∞–ø–∫—É. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤ —à–∞–ø–∫–∏ > —Ä–µ–∞–ª–∏–∑–º > —Ñ–æ–Ω.

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è (STEP 1)
- –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—ë–Ω OpenAI/DALL¬∑E.
- –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç **Anthropic Claude Sonnet** (—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π JSON, –±–µ–∑ –∫—Ä–µ–∞—Ç–∏–≤–∞).
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –∏–Ω–ø–µ–π—Ç–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç **Replicate FLUX** (`flux-schnell` –∏ `flux-fill-pro`).
- –ü–∞–π–ø–ª–∞–π–Ω: –±–∞–∑–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –±–µ–∑ —à–∞–ø–∫–∏ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Å–∫–∞ –≥–æ–ª–æ–≤—ã ‚Üí –∏–Ω–ø–µ–π—Ç–∏–Ω–≥ —à–∞–ø–∫–∏ –ø–æ –º–∞—Å–∫–µ.
- –¢–µ–ª–µ–≥—Ä–∞–º: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —à–∞–ø–∫–∏, –ø–æ–ª—É—á–∏—Ç–µ –∏—Ç–æ–≥–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞
–°–æ–∑–¥–∞–π—Ç–µ `.env` –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```
TELEGRAM_BOT_TOKEN=xxx
ANTHROPIC_API_KEY=xxx
REPLICATE_API_TOKEN=xxx
FLUX_BASE_MODEL=black-forest-labs/flux-schnell
FLUX_BASE_MODEL_PREVIEW=black-forest-labs/flux-schnell
FLUX_FILL_MODEL=black-forest-labs/flux-fill-pro
MAX_SIZE=512
STEPS_PREVIEW=4
STEPS_HQ=4
```

> `flux-schnell` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–Ω–µ –±–æ–ª–µ–µ 4 —à–∞–≥–æ–≤**; –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–º–µ–Ω—å—à–µ–Ω–æ. –î–ª—è –¥—Ä—É–≥–æ–π –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `flux-pro`) –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `STEPS_PREVIEW`/`STEPS_HQ`. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `FLUX_BASE_MODEL_PREVIEW` –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –¥–ª—è –¥–µ—à—ë–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `FLUX_BASE_MODEL`).

> –ó–Ω–∞—á–µ–Ω–∏—è `MAX_SIZE`, `STEPS_PREVIEW` –∏ `STEPS_HQ` —É–ø—Ä–∞–≤–ª—è—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ–º –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç–∫–æ–Ω–æ–º–Ω—ã–π **preview**.

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

## üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
```bash
python bot.py
```

–ö–æ–º–∞–Ω–¥—ã –∏ –æ—Ç–≤–µ—Ç—ã:
- `/start` ‚Äî –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è.
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —à–∞–ø–∫–∏ ‚Äî –±–æ—Ç –≤–µ—Ä–Ω—ë—Ç –≥–æ—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å —à–∞–ø–∫–æ–π –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ `outputs/metadata_*.json`.
- –û—à–∏–±–∫–∏ –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º.

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω
1. **–ê–Ω–∞–ª–∏–∑ –∏–∑–¥–µ–ª–∏—è** ‚Äî Claude Sonnet –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π JSON —Å–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–æ–π —à–∞–ø–∫–∏ (—Ü–≤–µ—Ç, –≤—è–∑–∫–∞, –æ—Ç–≤–æ—Ä–æ—Ç, –ø–æ–º–ø–æ–Ω, –ø–∞—Ç—á –∏ —Ç.–¥.).
2. **–ë–∞–∑–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** ‚Äî FLUX —Å–æ–∑–¥–∞—ë—Ç –ø–æ—Ä—Ç—Ä–µ—Ç –≤–∑—Ä–æ—Å–ª–æ–π –º–æ–¥–µ–ª–∏ **–±–µ–∑ –≥–æ–ª–æ–≤–Ω–æ–≥–æ —É–±–æ—Ä–∞** (preview: `MAX_SIZE`, `STEPS_PREVIEW`).
3. **–ú–∞—Å–∫–∞** ‚Äî –ø—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SAM; –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Å–∫–∞ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –≥–æ–ª–æ–≤—ã.
4. **–ò–Ω–ø–µ–π—Ç–∏–Ω–≥** ‚Äî FLUX Fill –∑–∞–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ–±–ª–∞—Å—Ç—å –º–∞—Å–∫–∏, —Å—Ç—Ä–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è —à–∞–ø–∫—É —Å —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–≥–æ —Ñ–æ—Ç–æ. –í–Ω–µ –º–∞—Å–∫–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è.

## üîß –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞
- **Preview (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)**: `MAX_SIZE=512`, `STEPS_PREVIEW=20` ‚Äî –±—ã—Å—Ç—Ä–æ –∏ –¥—ë—à–µ–≤–æ.
- **HQ**: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `STEPS_HQ` (–Ω–∞–ø—Ä–∏–º–µ—Ä 35) –∏ –ø–µ—Ä–µ–¥–∞–π—Ç–µ `QUALITY_MODE=hq` –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ. –†–∞–∑–º–µ—Ä –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —á–µ—Ä–µ–∑ `MAX_SIZE`, —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å.

## üß™ –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–≥–æ–Ω / smoke test
1. –ó–∞–¥–∞–π—Ç–µ –ø–æ–¥–¥–µ–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –∏ –≤–∫–ª—é—á–∏—Ç–µ echo-—Ä–µ–∂–∏–º Replicate (–∏–ª–∏ –º–æ–∫–Ω–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ `generate_base_model_image` –∏ `inpaint_hat`).
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `outputs/metadata_*.json` –∏ –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–µ—Å–ª–∏ –∫–ª—é—á–∏ –Ω–µ–≤–µ—Ä–Ω—ã) –ª–∏–±–æ –æ—Ç–¥–∞—ë—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É (–≤ –º–æ–∫–∞—Ö).

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- `bot.py` ‚Äî Telegram-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.
- `providers/anthropic.py` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ JSON-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ —à–∞–ø–∫–∏.
- `providers/replicate_flux.py` ‚Äî –±–∞–∑–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –∏–Ω–ø–µ–π—Ç–∏–Ω–≥ FLUX.
- `pipeline/hat_on_model.py` ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –∞–Ω–∞–ª–∏–∑ ‚Üí –±–∞–∑–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí –º–∞—Å–∫–∞ ‚Üí –∏–Ω–ø–µ–π—Ç–∏–Ω–≥.
- `utils/` ‚Äî —Ö–µ–ª–ø–µ—Ä—ã –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏, –º–∞—Å–æ–∫ –∏ —Ö–µ—à–µ–π.

## üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
- –ó–∞–º–µ–Ω–∏—Ç–µ –≤—ã–∑–æ–≤—ã Replicate/Anthropic —Ç–µ—Å—Ç–æ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–º–∏ —Å—Ç–∞—Ç–∏—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/JSON.
- –ü–æ–Ω–∏–∑—å—Ç–µ `MAX_SIZE` –∏ `STEPS_PREVIEW`, —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã.

## üìå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
- –ú–æ–¥–µ–ª—å ‚Äî —Ç–æ–ª—å–∫–æ –≤–∑—Ä–æ—Å–ª–∞—è –∂–µ–Ω—â–∏–Ω–∞.
- –ë–∞–∑–æ–≤—ã–π –∫–∞–¥—Ä –±–µ–∑ –≥–æ–ª–æ–≤–Ω–æ–≥–æ —É–±–æ—Ä–∞.
- –ò–Ω–ø–µ–π—Ç–∏–Ω–≥ –∏–∑–º–µ–Ω—è–µ—Ç **—Ç–æ–ª—å–∫–æ** –æ–±–ª–∞—Å—Ç—å –º–∞—Å–∫–∏; –ª–∏—Ü–æ, –≤–æ–ª–æ—Å—ã –∏ —Ñ–æ–Ω –∑–∞–ø—Ä–µ—â–µ–Ω–æ —Ç—Ä–æ–≥–∞—Ç—å.
- –ù–∏–∫–∞–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞/–≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ.
